{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project Harvey Chat</title>
   <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

</head>
<body class="bg-gray-100 flex flex-col h-screen">
  <header class="bg-indigo-600 text-white text-center py-4 text-xl font-semibold shadow">
    Harvey – AI HR Assistant
  </header>

  <main class="flex-1 overflow-y-auto p-4" id="chat-box">
    <div class="text-center text-gray-500">Start chatting with Harvey...</div>
  </main>

  <footer class="p-4 bg-white border-t flex gap-2">
    <input
      id="user-input"
      type="text"
      placeholder="Type your message..."
      class="flex-1 border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
    />
    <button
      id="send-btn"
      class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg"
    >
      Send
    </button>
  </footer>
</body>
</html>
<script>
    const sendBtn = document.getElementById("send-btn");
const userInput = document.getElementById("user-input");
const chatBox = document.getElementById("chat-box");

function appendMessage(sender, text) {
  const bubble = document.createElement("div");
  bubble.classList.add(
    "p-3",
    "rounded-lg",
    "max-w-lg",
    "my-2",
    sender === "user" ? "bg-indigo-500 text-white self-end ml-auto" : "bg-gray-200 text-gray-900"
  );
  bubble.textContent = text;
  chatBox.appendChild(bubble);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage() {
  const prompt = userInput.value.trim();
  if (!prompt) return;

  appendMessage("user", prompt);
  userInput.value = "";

  appendMessage("ai", "Thinking...");

  const bubbles = chatBox.querySelectorAll("div");
  const thinkingBubble = bubbles[bubbles.length - 1];

  try {
    const res = await fetch("/chat/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ prompt }),
    });

    const data = await res.json();
    thinkingBubble.remove();
    appendMessage("ai", data.response || data.error || "Error occurred.");
  } catch (err) {
    thinkingBubble.remove();
    appendMessage("ai", "⚠️ Server error.");
  }
}

sendBtn.addEventListener("click", sendMessage);
userInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") sendMessage();
});

</script>