{% extends 'admin_base.html' %}

{% block title %}Add Policy | {{ org.name }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white shadow rounded-lg p-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">Add New Policy</h2>

    {% if messages %}
    <div class="mb-4">
        {% for message in messages %}
        <div
            class="p-4 rounded-md {% if message.tags == 'error' %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data" class="space-y-6">
        {% csrf_token %}

        <div>
            <label for="title" class="block text-sm font-medium text-gray-700">Policy Title</label>
            <input type="text" name="title" id="title" required
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
        </div>

        <div>
            <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
            <textarea name="description" id="description" rows="3"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"></textarea>
        </div>

        <div>
            <label for="source_type" class="block text-sm font-medium text-gray-700">Source Type</label>
            <select name="source_type" id="source_type" onchange="toggleSourceFields()"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
                <option value="upload">File Upload (PDF, DOCX, TXT)</option>
                <option value="url">External URL</option>
            </select>
        </div>

        <div id="file-field">
            <label for="uploaded_file" class="block text-sm font-medium text-gray-700">Upload File</label>
            <input type="file" name="uploaded_file" id="uploaded_file"
                class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
        </div>

        <div id="url-field" class="hidden">
            <label for="external_url" class="block text-sm font-medium text-gray-700">External URL</label>
            <input type="url" name="external_url" id="external_url" placeholder="https://example.com/policy"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
        </div>

        <div class="flex justify-end pt-4">
            <a href="{% url 'manage_policies' %}"
                class="bg-gray-200 text-gray-700 px-4 py-2 rounded mr-2 hover:bg-gray-300">Cancel</a>
            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Add
                Policy</button>
        </div>
    </form>
</div>

<script>
    function toggleSourceFields() {
        const sourceType = document.getElementById('source_type').value;
        const fileField = document.getElementById('file-field');
        const urlField = document.getElementById('url-field');

        if (sourceType === 'upload') {
            fileField.classList.remove('hidden');
            urlField.classList.add('hidden');
            document.getElementById('uploaded_file').required = true;
            document.getElementById('external_url').required = false;
        } else {
            fileField.classList.add('hidden');
            urlField.classList.remove('hidden');
            document.getElementById('uploaded_file').required = false;
            document.getElementById('external_url').required = true;
        }
    }
</script>
{% endblock %}